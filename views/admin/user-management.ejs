

<%-include('../partials/adminTopBar')%>
		
<%-include('../partials/adminNav')%>

    
<!-- ============================================================== -->
<!-- 						Content Start	 						-->
<!-- ============================================================== -->
<div class="row page-header">
        <div class="col-lg-6 align-self-center ">
          <h2>User Management</h2>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">User Management</li>
            </ol>
        </div>
        
</div>
<!-- <style>
    /* Main content styling */
.content {
    padding: 20px;
    background-color: #f5f5f5;
}

.card {
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

/* Table styling */
.table {
    margin: 0;
    width: 100%;
}

.table-hover tbody tr:hover {
    background-color: #f0f0f5; /* Light hover effect */
}

thead th {
    font-weight: bold;
    color: #333;
    background-color: #e9ecef; /* Light grey background */
    border-bottom: 2px solid #dee2e6;
    padding: 15px;
}

/* Table row styling */
tbody tr {
    transition: background-color 0.2s;
}

tbody td {
    padding: 15px;
    color: #555;
    font-size: 0.95rem;
}

/* Action icon styling */
td a {
    color: #d9534f; /* Red color for delete icon */
    font-size: 1.2rem;
    transition: color 0.2s;
}

td a:hover {
    color: #b52a3a; /* Darker red on hover */
}

.fas.fa-trash {
    cursor: pointer;
}

.table td, .table th {
    text-align: center; /* Center align table data */
}

@media (max-width: 768px) {
    /* Responsive adjustments for small screens */
    .table thead {
        display: none; /* Hide table header on small screens */
    }

    .table tbody tr {
        display: flex;
        flex-direction: column;
        border-bottom: 1px solid #ddd;
        padding: 10px 0;
    }

    .table tbody td {
        padding: 10px;
        font-size: 0.9rem;
    }

    .table tbody td::before {
        content: attr(data-label);
        font-weight: bold;
        color: #333;
        display: block;
    }

    td a {
        font-size: 1.5rem;
    }
}

</style> -->

<section class="main-content">

	
		<main class="content p-0" style="overflow: scroll;">
            <div class="container-fluid p-0">
               
                <div class="col-12 col-lg-12 col-xxl-12 d-flex">
                    <div class="card flex-fill w-100 overflow-scroll">
                        <table class="table table-hover my-0">
                            <thead class="text-center">
                                <tr style="background-color: #ffffff;">
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Registered Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody class="text-center">
                                <% users.forEach(user => { %>
                                    <tr>
                                        <td><%= user.name %></td>
                                        <td><%= user.email %></td>
                                        <td><%= user.phone %></td>
                                        <td>
                                            <% 
                                              const date = new Date(user.registered_date);
                                              const formattedDate = date.toLocaleDateString("en-IN", {
                                                month: "short", // "Nov"
                                                day: "numeric", // "10"
                                                year: "numeric" // "2024"
                                              });
                                            %>
                                            <%= formattedDate %>
                                          </td>
                                          
                                        <td>
                                            <!-- Delete Action -->
                                            <a href="#"onclick="confirmDeleteUser(<%= user.id %>)"><i class="fas fa-trash"></i></a>
                &nbsp;
                                            <!-- File Upload Icon -->
                                            <a href="javascript:void(0)" class="upload-icon" data-toggle="modal" data-target="#uploadModal<%= user.id %>">
                                                <i class="fas fa-upload" title="Upload File"></i>
                                            </a>
                                        </td>
                                    </tr>
                
                                    <!-- Modal for File Upload -->
                                    <div class="modal fade" id="uploadModal<%= user.id %>" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel<%= user.id %>" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="uploadModalLabel<%= user.id %>">Upload File for <%= user.name %></h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <form action="/admin/upload-file/<%= user.id %>" method="POST" enctype="multipart/form-data">
                                                    <div class="modal-body">
                                                        <!-- Title Input Field -->
                                                        <div class="form-group">
                                                            <label for="fileTitle<%= user.id %>"> Title</label>
                                                            <input type="text" class="form-control" name="file_title" id="fileTitle<%= user.id %>" placeholder="Enter file title" required>
                                                        </div>
                
                                                        <!-- File Input Field -->
                                                        <div class="form-group">
                                                            <label for="fileInput<%= user.id %>">Select File</label>
                                                            <input type="file" name="file" id="fileInput<%= user.id %>" required>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                        <button type="submit" class="btn btn-primary">Upload</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                </div>             
            </div>
        </main>
	
		
		<% if (message) { %>
            <script>
                // Check the message type and show the appropriate SweetAlert
                Swal.fire({
                    title: `<%= message.type === 'success' ? 'Success' : 'Error' %>`,
                    text: '<%= message.text %>',
                    icon: '<%= message.type %>',
                    confirmButtonText: 'OK'
                });
            </script>
        <% } %>
        
	<footer class="footer">
		<span>Copyright &copy;  2024 Specterra Geotech Private Limited. All rights reserved.</span>
	</footer>

</section>
<!-- ============================================================== -->
<!-- 						Content End		 						-->
<!-- ============================================================== -->


<script>
    async function confirmDeleteUser(userId) {
        swal.fire({
            title: "Are you sure?",
            text: "Once deleted, you will not be able to recover this user!",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willDelete) => {
            if (willDelete) {
                fetch(`/admin/user-delete/${userId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        swal.fire("User has been deleted!", {
                            icon: "success",
                        }).then(() => {
                            location.reload(); // reload the page or update the UI
                        });
                    } else {
                        return response.json().then(errorData => {
                            swal.fire("Error deleting user: " + errorData.message, {
                                icon: "error",
                            });
                        });
                    }
                })
                .catch(error => {
                    swal.fire("An error occurred: " + error.message, {
                        icon: "error",
                    });
                });
            } else {
                swal.fire("User deletion canceled.");
            }
        });
    }
    </script>